# FunChat API Gateway - Cloudflare Worker Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "funchat-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Workers Logs - enable for debugging
[observability]
enabled = true

# ============================================================================
# KV Namespaces
# ============================================================================

[[kv_namespaces]]
binding = "API_KEY_CACHE"
id = "8c24ac5e7cad41098e28107295df6e9d"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "3bc338be1bf9492182af77634f580e9b"

[[kv_namespaces]]
binding = "JWKS_CACHE"
id = "7d76aae6b6fb45618a950ce732512f03"

# ============================================================================
# Environment Variables (non-sensitive)
# ============================================================================

[vars]
SUPABASE_FUNCTIONS_URL = "https://ovswkgujezxwygselcap.supabase.co/functions/v1"
# Comma-separated list of allowed origins
ALLOWED_ORIGINS = "https://cherish-bloom-box.lovable.app,https://id-preview--749ec9dd-2892-4224-a79d-197ee88ac12d.lovable.app,https://preview.lovable.app,*.lovable.app,*.lovableproject.com,http://localhost:5173,http://localhost:8787"

# ============================================================================
# Secrets (set via `wrangler secret put`)
# ============================================================================
# SUPABASE_URL - Your Supabase project URL
# SUPABASE_SERVICE_KEY - Your Supabase service role key
# SUPABASE_JWT_SECRET - Your Supabase JWT secret

# ============================================================================
# Production Environment
# ============================================================================

[env.production]
name = "funchat-api-gateway-prod"

[[env.production.kv_namespaces]]
binding = "API_KEY_CACHE"
id = "8c24ac5e7cad41098e28107295df6e9d"

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT"
id = "3bc338be1bf9492182af77634f580e9b"

[[env.production.kv_namespaces]]
binding = "JWKS_CACHE"
id = "7d76aae6b6fb45618a950ce732512f03"

[env.production.vars]
SUPABASE_FUNCTIONS_URL = "https://ovswkgujezxwygselcap.supabase.co/functions/v1"
ALLOWED_ORIGINS = "https://cherish-bloom-box.lovable.app,https://id-preview--749ec9dd-2892-4224-a79d-197ee88ac12d.lovable.app,*.lovable.app,*.lovableproject.com"

# ============================================================================
# Routes (optional - for custom domain)
# ============================================================================
# routes = [
#   { pattern = "api.funchat.io/*", zone_name = "funchat.io" }
# ]
