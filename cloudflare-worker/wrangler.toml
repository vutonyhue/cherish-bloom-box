# FunChat API Gateway - Cloudflare Worker Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "funchat-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Account ID (optional - will use logged in account)
account_id = "a92947e708fdb2b85c14542347f42a4e"

# Workers Logs - enable for debugging
# [observability]
# enabled = true

# ============================================================================
# KV Namespaces
# ============================================================================
# Run `npm run setup:kv` to create these, then update the IDs below
# Or run `npm run setup` for automated setup

[[kv_namespaces]]
binding = "API_KEY_CACHE"
id = "a77f0e51d44940f485c2f217e188e63c"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "14d0231a374c4d85893aec62355686f7"

[[kv_namespaces]]
binding = "JWKS_CACHE"
id = "fafe99f97e25403e9dfec9223c4605fc"

# ============================================================================
# Environment Variables (non-sensitive)
# ============================================================================

[vars]
SUPABASE_FUNCTIONS_URL = "https://ovswkgujezxwygselcap.supabase.co/functions/v1"
# Comma-separated list of allowed origins
ALLOWED_ORIGINS = "https://cherish-bloom-box.lovable.app,https://id-preview--749ec9dd-2892-4224-a79d-197ee88ac12d.lovable.app,https://749ec9dd-2892-4224-a79d-197ee88ac12d.lovableproject.com"

# ============================================================================
# Secrets (set via `wrangler secret put` or `npm run setup:secrets`)
# ============================================================================
# SUPABASE_URL - Your Supabase project URL
# SUPABASE_SERVICE_KEY - Your Supabase service role key
# SUPABASE_JWT_SECRET - Your Supabase JWT secret (for verifying user tokens)

# ============================================================================
# Production Environment
# ============================================================================

[env.production]
name = "funchat-api-gateway-prod"

[[env.production.kv_namespaces]]
binding = "API_KEY_CACHE"
id = "__API_KEY_CACHE_PROD_ID__"

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT"
id = "__RATE_LIMIT_PROD_ID__"

[[env.production.kv_namespaces]]
binding = "JWKS_CACHE"
id = "__JWKS_CACHE_PROD_ID__"

[env.production.vars]
SUPABASE_FUNCTIONS_URL = "https://ovswkgujezxwygselcap.supabase.co/functions/v1"
ALLOWED_ORIGINS = "https://holo-talk-cash.lovable.app"

# ============================================================================
# Routes (optional - for custom domain)
# ============================================================================
# routes = [
#   { pattern = "api.funchat.io/*", zone_name = "funchat.io" }
# ]

# ============================================================================
# Triggers (optional - for scheduled tasks)
# ============================================================================
# [triggers]
# crons = ["0 * * * *"]  # Every hour
